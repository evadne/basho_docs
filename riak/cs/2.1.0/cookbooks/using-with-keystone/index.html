<!DOCTYPE html>







<html class="no-js" lang="en">




<head>

  <meta charset="utf-8">
  <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
  <meta name="viewport" content="width=device-width">
  <link rel="shortcut icon" href="//evadne.github.io/basho_docs/images/branding/favicon.ico" type="image/x-icon" />

  <title>Using Riak CS With Keystone</title>

  <link href="//evadne.github.io/basho_docs/css/main.css" media="screen" rel="stylesheet" type="text/css">
  <link rel="canonical" href="//evadne.github.io/basho_docs/riak/cs/latest/cookbooks/using-with-keystone/" />
  <!-- The below meta tags are included to allow JS code to use variables
       defined in Hugo---our static site generator. -->
  <meta name="project" content="riak_cs">
  <meta name="version" content="2.1.0">
  <meta name="project_relative_path" content="cookbooks/using-with-keystone/">

</head>



<body class="riak_cs 2.1.0  ">


  <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-T9C8MK" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-T9C8MK');</script>


  
<header class="banner">



  
  <div class="float-right   banner__menu-bars   [bs] hidden-md-up">
    <div class="menu-bars   js_toggle-content-nav"></div>
  </div>



  
  <div class="float-left   banner__docs-logo">
    <a href="//evadne.github.io/basho_docs/index.html" class="block   docs-logo"><img class="docs-logo__image" src="//evadne.github.io/basho_docs/images/branding/basho_docs_logo.png"></a>
  </div>



  
  <div class="overflow-hidden   banner__navigation-pane   [bs] hidden-sm-down">


    
    <div class="float-left    banner__intra-brand__width-wrapper">
    <div class="float-right   banner__intra-brand">
      <div class="float-right">
        
        <a class="inline-block   banner__brand-link" href="http://basho.com/">Basho</a><a class="inline-block   banner__brand-link" href="https://academy.basho.com">Academy</a><a class="inline-block   banner__brand-link" href="//evadne.github.io/basho_docs/community">Community</a><a class="inline-block   banner__brand-link" href="http://basho.com/contact">Contact</a></div>
    </div>
    </div>




    
    <div class="float-left    banner__intra-site__width-wrapper">
    <div class="float-right   banner__intra-site">
      
      <a class="inline-block   banner__brand-link " href="//evadne.github.io/basho_docs/riak/kv/latest/">Riak KV</a><a class="inline-block   banner__brand-link " href="//evadne.github.io/basho_docs/riak/ts/latest/">Riak TS</a><a class="inline-block   banner__brand-link banner__brand-link--current">Riak CS</a></div>
    </div>


  </div>

</header>



  
  



<nav class="content-nav content-nav--top-size-full">




  <div class="content-nav__fixed-top">
    <form id="searchbox_011972015458788978446:zgdcy4fa-o0" class="search" action="">

      <span class="block float-left   search__icon-container   docs-icon--search">|</span>

      <span class="block overflow">
        <input class="search__input" id="main-search" type="search" name="q" placeholder="Search">
      </span>

    </form>


    <div class="clearfix   version-picker">

  
      <a class="inline-block float-left    product__title" href="//evadne.github.io/basho_docs/"><img class="product__logo" src="//evadne.github.io/basho_docs/images/branding/riak-logo.png">Riak<span class="product__title-highlight">CS</span>
      </a>
  

      <div class="inline-block float-right   selector selector--version">
        <header class="selector__title">Versions</header>
        <button class="selector__btn" type="button">2.1.0</button>
        <div    class="selector__arrow"></div>
      </div>

    </div>


  </div>


  
  <div class="overflow-y-hidden   selector-pane__sizing-box selector-pane__sizing-box--hidden">
  <div class="                    selector-pane__shadow-box">

    
    <div class="edge-fader edge-fader--left">
      <span class="inline-block   edge-fader__arrow edge-fader__arrow--invisible"></span>
    </div>
    <div class="edge-fader edge-fader--right">
      <span class="inline-block   edge-fader__arrow edge-fader__arrow--invisible"></span>
    </div>

    <div class="overflow-x        selector-pane__primary selector-pane--versions  js_edge-fader--target">
      
    </div>
  </div>
  </div>




  
  <div class="             content-nav__primary__sizing-box">
  <div class="             content-nav__primary__shadow-box">
  <div class="overflow-y   content-nav__primary">

    <div class="content-nav__menu-container">

      <ul class="content-menu
                 content-menu--depth-0
                 content-menu--open">


        <li >

          <div class="content-menu__item ">

            <span class="block float-left   content-menu__icon-container   docs-icon--bolt">|</span>
            <span class="block float-right   content-menu__menu-toggle
                        ">
            </span>

            <a class="block overflow   content-menu__link--depth-0"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/" >
              <span class="block   content-menu__item__right-border"><strong>Riak CS</strong></span>
            </a>

          </div>
          
          


<ul class="content-menu
           content-menu--depth-1
           "
    style="display: none">



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/downloads/" >
        <span class="block   content-menu__item__right-border">Download Riak CS</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/cookbooks/installing/" >
        <span class="block   content-menu__item__right-border">Installing Riak CS</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/cookbooks/installing/chef/" >
        <span class="block   content-menu__item__right-border">Installing With Chef</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">
      <span class="block float-right   content-menu__menu-toggle
                  ">
      </span>

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/tutorials/fast-track/" >
        <span class="block   content-menu__item__right-border">The Riak CS Fast Track</span>
      </a>

    </div>
    
    


<ul class="content-menu
           content-menu--depth-2
           "
    style="display: none">



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-2"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/tutorials/fast-track/what-is-riak-cs/" >
        <span class="block   content-menu__item__right-border">What Is Riak CS?</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-2"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/tutorials/fast-track/local-testing-environment/" >
        <span class="block   content-menu__item__right-border">Building a Local Test Environment</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-2"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/tutorials/fast-track/virtual-test-environment/" >
        <span class="block   content-menu__item__right-border">Building a Virtual Test Environment</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-2"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/tutorials/fast-track/test-installation/" >
        <span class="block   content-menu__item__right-border">Testing the Installation</span>
      </a>

    </div>

  </li>



</ul>

  </li>



</ul>

        </li>


        <li >

          <div class="content-menu__item ">

            <span class="block float-left   content-menu__icon-container   docs-icon--lambda">|</span>
            <span class="block float-right   content-menu__menu-toggle
                         content-menu__menu-toggle--open ">
            </span>

            <a class="block overflow   content-menu__link--depth-0"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/developing/" >
              <span class="block   content-menu__item__right-border"><strong>Developing</strong></span>
            </a>

          </div>
          
          


<ul class="content-menu
           content-menu--depth-1
           content-menu--open"
    style="display: block">



  <li>

    <div class="content-menu__item ">
      <span class="block float-right   content-menu__menu-toggle
                  ">
      </span>

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/references/appendices/http-admin/" >
        <span class="block   content-menu__item__right-border">Accounts &amp; Admin</span>
      </a>

    </div>
    
    


<ul class="content-menu
           content-menu--depth-2
           "
    style="display: none">



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-2"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/cookbooks/account-management/" >
        <span class="block   content-menu__item__right-border">Account Management</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-2"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/cookbooks/access-control-lists/" >
        <span class="block   content-menu__item__right-border">Access Control Lists</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-2"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/cookbooks/authentication/" >
        <span class="block   content-menu__item__right-border">Authentication</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-2"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/cookbooks/usage-and-billing-data/" >
        <span class="block   content-menu__item__right-border">Usage and Billing Data</span>
      </a>

    </div>

  </li>



</ul>

  </li>



  <li>

    <div class="content-menu__item ">
      <span class="block float-right   content-menu__menu-toggle
                   content-menu__menu-toggle--open ">
      </span>

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/references/apis/" >
        <span class="block   content-menu__item__right-border">APIs</span>
      </a>

    </div>
    
    


<ul class="content-menu
           content-menu--depth-2
           content-menu--open"
    style="display: block">



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-2"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/references/apis/storage/" >
        <span class="block   content-menu__item__right-border">Riak CS Storage API</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">
      <span class="block float-right   content-menu__menu-toggle
                  ">
      </span>

      <a class="block overflow   content-menu__link--depth-2"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/references/apis/storage/s3/" >
        <span class="block   content-menu__item__right-border">S3 API</span>
      </a>

    </div>
    
    


<ul class="content-menu
           content-menu--depth-3
           "
    style="display: none">



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-3"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/cookbooks/configuration/s3-client/" >
        <span class="block   content-menu__item__right-border">Configuring an S3 Client</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-3"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/cookbooks/fog/" >
        <span class="block   content-menu__item__right-border">Fog on Riak CS</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-3"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/cookbooks/configuration/dragondisk/" >
        <span class="block   content-menu__item__right-border">Configuring DragonDisk</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-3"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/cookbooks/configuration/transmit/" >
        <span class="block   content-menu__item__right-border">Configuring Transmit</span>
      </a>

    </div>

  </li>



</ul>

  </li>



  <li>

    <div class="content-menu__item ">
      <span class="block float-right   content-menu__menu-toggle
                   content-menu__menu-toggle--open ">
      </span>

      <a class="block overflow   content-menu__link--depth-2"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/references/apis/storage/openstack/" >
        <span class="block   content-menu__item__right-border">OpenStack API</span>
      </a>

    </div>
    
    


<ul class="content-menu
           content-menu--depth-3
           content-menu--open"
    style="display: block">



  <li>

    <div class="content-menu__item  content-menu__item--selected ">

      <a class="block overflow   content-menu__link--depth-3" >
        <span class="block   content-menu__item__right-border">Using Riak CS With Keystone</span>
      </a>

    </div>

  </li>



</ul>

  </li>



</ul>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/cookbooks/querying-access-statistics/" >
        <span class="block   content-menu__item__right-border">Access Statistics</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/cookbooks/querying-storage-statistics/" >
        <span class="block   content-menu__item__right-border">Storage Statistics</span>
      </a>

    </div>

  </li>



</ul>

        </li>


        <li >

          <div class="content-menu__item ">

            <span class="block float-left   content-menu__icon-container   docs-icon--database">|</span>
            <span class="block float-right   content-menu__menu-toggle
                        ">
            </span>

            <a class="block overflow   content-menu__link--depth-0"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/operating/" >
              <span class="block   content-menu__item__right-border"><strong>Operating</strong></span>
            </a>

          </div>
          
          


<ul class="content-menu
           content-menu--depth-1
           "
    style="display: none">



  <li>

    <div class="content-menu__item ">
      <span class="block float-right   content-menu__menu-toggle
                  ">
      </span>

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/cookbooks/configuration/" >
        <span class="block   content-menu__item__right-border">Configuring</span>
      </a>

    </div>
    
    


<ul class="content-menu
           content-menu--depth-2
           "
    style="display: none">



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-2"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/cookbooks/configuration/riak-for-cs/" >
        <span class="block   content-menu__item__right-border">Configuring Riak KV for CS</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-2"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/cookbooks/configuration/riak-cs/" >
        <span class="block   content-menu__item__right-border">Configuring Riak CS</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-2"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/cookbooks/configuration/stanchion/" >
        <span class="block   content-menu__item__right-border">Configuring Stanchion</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-2"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/cookbooks/configuration/load-balancing-proxy/" >
        <span class="block   content-menu__item__right-border">Load Balancing &amp; Proxy Configuration</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-2"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/cookbooks/configuration/reference/" >
        <span class="block   content-menu__item__right-border">Configuration Reference</span>
      </a>

    </div>

  </li>



</ul>

  </li>



  <li>

    <div class="content-menu__item ">
      <span class="block float-right   content-menu__menu-toggle
                  ">
      </span>

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/operating/running/" >
        <span class="block   content-menu__item__right-border">Running</span>
      </a>

    </div>
    
    


<ul class="content-menu
           content-menu--depth-2
           "
    style="display: none">



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-2"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/cookbooks/command-line-tools/" >
        <span class="block   content-menu__item__right-border">Command-line Tools</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-2"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/cookbooks/installing/launching-and-stopping/" >
        <span class="block   content-menu__item__right-border">Launching and Stopping</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-2"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/cookbooks/logging/" >
        <span class="block   content-menu__item__right-border">Logging</span>
      </a>

    </div>

  </li>



</ul>

  </li>



  <li>

    <div class="content-menu__item ">
      <span class="block float-right   content-menu__menu-toggle
                  ">
      </span>

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/operating/advanced/" >
        <span class="block   content-menu__item__right-border">Advanced</span>
      </a>

    </div>
    
    


<ul class="content-menu
           content-menu--depth-2
           "
    style="display: none">



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-2"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/cookbooks/rolling-upgrades/" >
        <span class="block   content-menu__item__right-border">Rolling Upgrades</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-2"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/cookbooks/monitoring-and-metrics/" >
        <span class="block   content-menu__item__right-border">Monitoring &amp; Metrics</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-2"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/references/appendices/riak-cs-control/" >
        <span class="block   content-menu__item__right-border">Riak CS Control</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-2"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/cookbooks/supercluster/" >
        <span class="block   content-menu__item__right-border">Riak CS Supercluster Support</span>
      </a>

    </div>

  </li>



</ul>

  </li>



</ul>

        </li>


        <li >

          <div class="content-menu__item ">

            <span class="block float-left   content-menu__icon-container   docs-icon--beaker">|</span>
            <span class="block float-right   content-menu__menu-toggle
                        ">
            </span>

            <a class="block overflow   content-menu__link--depth-0"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/theory/" >
              <span class="block   content-menu__item__right-border"><strong>Theory &amp; Concepts</strong></span>
            </a>

          </div>
          
          


<ul class="content-menu
           content-menu--depth-1
           "
    style="display: none">



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/theory/stanchion/" >
        <span class="block   content-menu__item__right-border">Stanchion</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/cookbooks/multipart-upload-overview/" >
        <span class="block   content-menu__item__right-border">Multipart Upload Overview</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/cookbooks/garbage-collection/" >
        <span class="block   content-menu__item__right-border">Garbage Collection</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">
      <span class="block float-right   content-menu__menu-toggle
                  ">
      </span>

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/theory/comparisons/" >
        <span class="block   content-menu__item__right-border">Comparisons</span>
      </a>

    </div>
    
    


<ul class="content-menu
           content-menu--depth-2
           "
    style="display: none">



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-2"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/references/appendices/comparisons/swift/" >
        <span class="block   content-menu__item__right-border">Riak CS Compared To Swift</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-2"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/references/appendices/comparisons/atmos/" >
        <span class="block   content-menu__item__right-border">Riak CS Compared To Atmos</span>
      </a>

    </div>

  </li>



</ul>

  </li>



</ul>

        </li>


        <li >

          <div class="content-menu__item ">

            <span class="block float-left   content-menu__icon-container   docs-icon--references">|</span>
            <span class="block float-right   content-menu__menu-toggle
                        ">
            </span>

            <a class="block overflow   content-menu__link--depth-0"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/reference/" >
              <span class="block   content-menu__item__right-border"><strong>Reference</strong></span>
            </a>

          </div>
          
          


<ul class="content-menu
           content-menu--depth-1
           "
    style="display: none">



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/cookbooks/faqs/riak-cs/" >
        <span class="block   content-menu__item__right-border">FAQs</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/cookbooks/version-compatibility/" >
        <span class="block   content-menu__item__right-border">Version Compatibility</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/cookbooks/release-notes/" >
        <span class="block   content-menu__item__right-border">Riak CS Release Notes</span>
      </a>

    </div>

  </li>



</ul>

        </li>


        <li >

          <div class="content-menu__item ">

            <span class="block float-left   content-menu__icon-container   docs-icon--cloud">|</span>
            <span class="block float-right   content-menu__menu-toggle
                        ">
            </span>

            <a class="block overflow   content-menu__link--depth-0"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/cookbooks/multi-datacenter-overview/" >
              <span class="block   content-menu__item__right-border"><strong>Riak CS Enterprise</strong></span>
            </a>

          </div>
          
          


<ul class="content-menu
           content-menu--depth-1
           "
    style="display: none">



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/riak/cs/2.1.0/cookbooks/configuration/multi-datacenter/" >
        <span class="block   content-menu__item__right-border">Configuring</span>
      </a>

    </div>

  </li>



</ul>

        </li>

        <li class="content-menu__blank-entry"></li>

      </ul>

    </div>



    <div class="content-nav__fixed-bottom">

      <ul class="content-menu">

        <li>
          <div class="content-menu__item">

            <span class="block float-left   content-menu__icon-container   docs-icon--comments">|</span>

            <a class="block overflow" href="//evadne.github.io/basho_docs/community">
              <span class="block   content-menu__item__right-border">
                <sub>Want some extra help?</sub><br>
                <strong>Ask our Community</strong>
              </span>
            </a>

          </div>
        </li>

        <li>
          <div class="content-menu__item">

            <span class="block float-left   content-menu__icon-container   docs-icon--question-sign">|</span>

            <a class="block overflow" href="http://basho.com/contact">
              <span class="block   content-menu__item__right-border">
                <sub>Need to chat?</sub><br>
                <strong>Contact us directly</strong>
              </span>
            </a>

          </div>
        </li>

        <li>
          <div class="content-menu__item">

            <span class="block float-left   content-menu__icon-container   docs-icon--github-alt">|</span>

            <a class="block overflow" href="https://github.com/basho/basho_docs/edit/master/content/riak/cs/2.1.0/cookbooks/using-with-keystone.md">
              <span class="block   content-menu__item__right-border">
                <sub>Noticed a typo?</sub><br>
                <strong>Correct it in GitHub</strong>
              </span>
            </a>

          </div>
        </li>

      </ul>

    </div>

  </div>
  </div>
  </div>



</nav>

<script>
  (function() {
    var cx = '011972015458788978446:zgdcy4fa-o0';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<div style="width:0px;overflow:hidden;height:0px;">
  <gcse:search></gcse:search>
</div>






  <div class="content-well">


    <article class="main-article">


      

<header class="front-matter">


  <h1 class="front-matter__title">

    
    <br>
    Using Riak CS With Keystone

  </h1>
  <nav class="table-of-contents"></nav>


</header>


      <main>
        

<p>This document shows you how to configure Riak CS to work with the
<a href="http://docs.openstack.org/developer/keystone/">OpenStack Keystone</a>
authentication service.</p>

<p>Riak CS can be configured to use either the OpenStack Object Storage API
or the S3 API in conjunction with Keystone for authentication.</p>

<h2 id="terminology">Terminology</h2>

<p>In a system that uses Keystone for authentication, there are three main
entity types to be aware of: <code>tenants</code>, <code>users</code>, and <code>roles</code>.</p>

<ul>
<li><code>tenant</code> &mdash; A tenant is a collection entity that can contain a number
of users</li>
<li><code>user</code> &mdash; A user represents an individual that uses the OpenStack
system</li>
<li><code>role</code> &mdash; A role is used to define a link between a user and a tenant
and to indicate permissions of the user within that tenant</li>
</ul>

<p>The OpenStack <code>tenant_id</code> maps to a <code>key_id</code> to identify a user account
in Riak CS. In OpenStack, only users who are assigned an <code>operator</code> role
for a tenant may perform operations. Other users that belong to a tenant
may be granted access using ACLs.</p>

<p>Currently, Riak CS does not support OpenStack ACLs and only permits
access to  tenant operators. ACLs will be supported at a later date.</p>

<p>By default, Riak CS recognizes <code>admin</code> and <code>swiftoperator</code> as valid
operator roles, but that list can be configured.</p>

<p>Riak CS does not currently support the use of multiple authentication
servers via <em>reseller prefixes</em>, but if this turns out to be important
based on user feedback, support may be added in the future.</p>

<h2 id="configuration">Configuration</h2>

<h4 id="api">API</h4>

<p>Set the API using the <code>rewrite_module</code> configuration in the Riak CS
<code>riak-cs.conf</code> file, or the old-style <code>app.config</code> file in the <code>riak_cs</code>
section.</p>

<p>To use the S3 API, insert the following:</p>

<pre><code class="language-riakcsconf">rewrite_module = riak_cs_s3_rewrite
</code></pre>

<pre><code class="language-appconfig">{riak_cs, [
           %% Other configs
           {rewrite_module, riak_cs_s3_rewrite},
           %% Other configs
          ]}
</code></pre>

<p>To use the OpenStack object storage API:</p>

<pre><code class="language-riakcsconf">rewrite_module = riak_cs_oos_rewrite
</code></pre>

<pre><code class="language-appconfig">{riak_cs, [
           %% Other configs
           {rewrite_module, riak_cs_oos_rewrite},
           %% Other configs
          ]}
</code></pre>

<h4 id="authentication-module">Authentication Module</h4>

<p>Set the authentication module using the <code>auth_module</code> configuration in the Riak
CS <code>riak-cs.conf</code> file, or the old-style <code>app.config</code> file in the <code>riak_cs</code>
section.</p>

<p>To specify the Keystone authentication module:</p>

<pre><code class="language-riakcsconf">auth_module = riak_cs_keystone_auth
</code></pre>

<pre><code class="language-appconfig">{riak_cs, [
           %% Other configs
           {auth_module, riak_cs_keystone_auth},
           %% Other configs
          ]}
</code></pre>

<h4 id="operator-roles">Operator Roles</h4>

<p>You may optionally override the default list of valid operator roles in the
<code>advanced.config</code> file, or the<code>app.config</code> file. The default roles are <code>admin</code>
and <code>swiftoperator</code>, but others may be used:</p>

<pre><code class="language-advancedconfig"> {riak_cs, [
            %% Other configs
            {os_operator_roles, [&lt;&lt;&quot;admin&quot;&gt;&gt;, &lt;&lt;&quot;swiftoperator&quot;&gt;&gt;, &lt;&lt;&quot;cinnamon&quot;&gt;&gt;]},
            %% Other configs
           ]}
</code></pre>

<pre><code class="language-appconfig"> {riak_cs, [
            %% Other configs
            {os_operator_roles, [&lt;&lt;&quot;admin&quot;&gt;&gt;, &lt;&lt;&quot;swiftoperator&quot;&gt;&gt;, &lt;&lt;&quot;cinnamon&quot;&gt;&gt;]},
            %% Other configs
           ]}
</code></pre>

<p><strong>Note</strong>: Each role should be formatted as shown above, with two angle
brackets preceding and following each role value.</p>

<h4 id="root-host">Root Host</h4>

<p>Make sure that the value of the <code>root_host</code> key in the Riak CS <code>riak-cs.conf</code>
file, or the <code>cs_root_host</code> key in the old-style <code>advanced.config</code> or
<code>app.config</code> files matches the root host used for the object store in the
Keystone configuration.</p>

<p>For example, given the following config snippet from a Keystone configuration
file, the value for <code>root_host</code> (or <code>cs_root_host</code>) should be set to
<code>object.store.host</code>:</p>

<pre><code class="language-config">catalog.RegionOne.object_store.publicURL = http://object.store.host/v1/AUTH_$(tenant_id)s
catalog.RegionOne.object_store.adminURL = http://object.store.host/
catalog.RegionOne.object_store.internalURL = http://object.store.host/v1/AUTH_$(tenant_id)s
</code></pre>

<p>The entry in the Riak CS configuration file would be as follows:</p>

<pre><code class="language-riakcsconf">root_host = object.store.host
</code></pre>

<pre><code class="language-advancedconfig"> {riak_cs, [
            %% Other configs
            {cs_root_host, &quot;object.store.host&quot;},
            %% Other configs
           ]}
</code></pre>

<pre><code class="language-appconfig"> {riak_cs, [
            %% Other configs
            {cs_root_host, &quot;object.store.host&quot;},
            %% Other configs
           ]}
</code></pre>

<h4 id="admin-token">Admin Token</h4>

<p>Riak CS needs to know the administration token so that it can successfully
validate user tokens with Keystone. If no value for <code>os_admin_token</code> is
specified, the default value is <code>ADMIN</code>. The value can be set by adding the
following to the <code>riak_cs</code> section of the Riak CS <code>advanced.config</code> or
<code>app.config</code> files:</p>

<pre><code class="language-advancedconfig"> {riak_cs, [
            %% Other configs
            {os_admin_token, &quot;SNARFSNARFSNARF&quot;},
            %% Other configs
           ]}
</code></pre>

<pre><code class="language-appconfig"> {riak_cs, [
            %% Other configs
            {os_admin_token, &quot;SNARFSNARFSNARF&quot;},
            %% Other configs
           ]}
</code></pre>

<h4 id="auth-url">Auth URL</h4>

<p>Riak CS also needs to know the authentication URL to use to communicate with
Keystone. The default value is <code>&quot;http://localhost:5000/v2.0&quot;</code>. To override this
value add the following to the <code>riak_cs</code> section of the Riak CS
<code>advanced.config</code> or <code>app.config</code> files:</p>

<pre><code class="language-advancedconfig"> {riak_cs, [
            %% Other configs
            {os_auth_url, &quot;http://host.with.the.most.com:5000/v2.0&quot;},
            %% Other configs
           ]}
</code></pre>

<pre><code class="language-appconfig"> {riak_cs, [
            %% Other configs
            {os_auth_url, &quot;http://host.with.the.most.com:5000/v2.0&quot;},
            %% Other configs
           ]}
</code></pre>

<h4 id="keystone-resources">Keystone Resources</h4>

<p>Riak CS needs to be be aware of a few resources to be able to perform
authentication with Keystone. These resources are unlikely to need to be
changed from their defaults, but that capability is provided in case the
need arises.</p>

<ul>
<li>Token Resources</li>
</ul>

<p>The default is <code>&quot;tokens/&quot;</code>. To override this, add the following to the <code>riak_cs</code>
section of the Riak CS <code>advanced.config</code> or <code>app.config</code> files:</p>

<pre><code class="language-advancedconfig"> {riak_cs, [
            %% Other configs
            {os_tokens_resource, &quot;mytokens/&quot;},
            %% Other configs
           ]}
</code></pre>

<pre><code class="language-appconfig"> {riak_cs, [
            %% Other configs
            {os_tokens_resource, &quot;mytokens/&quot;},
            %% Other configs
           ]}
</code></pre>

<ul>
<li>S3 Token Resources</li>
</ul>

<p>This resource is only used when the S3 API is used in conjunction with Keystone
authentication. The default is <code>&quot;s3tokens/&quot;</code>. To override this, add the
following to the <code>riak_cs</code> section of the Riak CS <code>advanced.config</code> or
<code>app.config</code> files:</p>

<pre><code class="language-advancedconfig"> {riak_cs, [
            %% Other configs
            {os_s3_tokens_resource, &quot;mys3tokens/&quot;},
            %% Other configs
           ]}
</code></pre>

<pre><code class="language-appconfig"> {riak_cs, [
            %% Other configs
            {os_s3_tokens_resource, &quot;mys3tokens/&quot;},
            %% Other configs
           ]}
</code></pre>

<ul>
<li>User Resources</li>
</ul>

<p>The default is <code>&quot;users/&quot;</code>. To override this, add the following to the <code>riak_cs</code>
section of the Riak CS <code>advanced.config</code> or <code>app.config</code> files:</p>

<pre><code class="language-advancedconfig"> {riak_cs, [
            %% Other configs
            {os_users_resource, &quot;users/&quot;},
            %% Other configs
           ]}
</code></pre>

<pre><code class="language-appconfig"> {riak_cs, [
            %% Other configs
            {os_users_resource, &quot;users/&quot;},
            %% Other configs
           ]}
</code></pre>

<h2 id="testing">Testing</h2>

<h3 id="keystone-setup">Keystone Setup</h3>

<p>Follow the procedures documented in <a href="//evadne.github.io/basho_docs/riak/cs/2.1.0/cookbooks/keystone-setup">Keystone Setup</a> to set up and run
Keystone.</p>

<ol>
<li><p>Create a tenant called <code>test</code>:</p>

<pre><code class="language-bash">keystone tenant-create --name test
</code></pre></li>

<li><p>Using the tenant id of the tenant created in the previous step and
create a user called <code>test</code> that is a member of tenant <code>test</code>:</p>

<pre><code class="language-bash">keystone user-create --name test \
  --pass test --email test@test.com \
  --tenant-id &lt;tenant-id&gt; --enabled true
</code></pre></li>

<li><p>Create a role called <code>swiftoperator</code>:</p>

<pre><code class="language-bash">keystone role-create --name swiftoperator
</code></pre></li>

<li><p>Add the <code>swiftoperator</code> role for user <code>test</code>:</p>

<pre><code class="language-bash">keystone user-role-add --user-id &lt;user-id&gt;  \
--role-id &lt;role-id&gt; --tenant-id &lt;tenant-id&gt;
</code></pre></li>

<li><p>Create ec2 credentials for the user <code>test</code>:</p>

<pre><code class="language-bash">keystone ec2-credentials-create --user_id &lt;user-id&gt; \
--tenant_id &lt;tenant-id&gt;
</code></pre></li>
</ol>

<h3 id="testing-openstack-api-and-keystone-authentication">Testing Openstack API and Keystone authentication</h3>

<ol>
<li><p>Start Riak, Riak CS, and Stanchion. Make sure that the values for the
<code>rewrite_module</code> and <code>auth_module</code> keys in the Riak CS <code>riak-cs.conf</code> file,
or the old-style <code>advanced.config</code> or <code>app.config</code> file in the <code>riak_cs</code>
section, are set as follows:</p>

<pre><code class="language-riakcsconf">rewrite_module = riak_cs_oos_rewrite
auth_module = riak_cs_keystone_auth
</code></pre>

<pre><code class="language-advancedconfig">{riak_cs, [
           %% Other configs
           {rewrite_module, riak_cs_oos_rewrite},
           {auth_module, riak_cs_keystone_auth},
           %% Other configs
          ]}
</code></pre>

<pre><code class="language-appconfig">{riak_cs, [
           %% Other configs
           {rewrite_module, riak_cs_oos_rewrite},
           {auth_module, riak_cs_keystone_auth},
           %% Other configs
          ]}
</code></pre></li>

<li><p>Get an auth token for the <code>test</code> user to use in requests to Riak CS:</p>

<pre><code class="language-curl">curl -s -d '{&quot;auth&quot;: {&quot;tenantName&quot;: &quot;test&quot;, &quot;passwordCredentials&quot;: {&quot;username&quot;: &quot;test&quot;, &quot;password&quot;: &quot;test&quot;}}}' \
  -H 'Content-type: application/json' \
  http://localhost:5000/v2.0/tokens | python -mjson.tool
</code></pre>

<p>The value of the <code>id</code> field of the <code>token</code> object in the response is
used as the value for the <code>X-Auth-Token</code> header in all subsequent
requests to Riak CS. The <code>publicURL</code> for the <code>object-store</code> service
listed in the <code>serviceCatalog</code> of the response is the base URL used
for all API requests to Riak CS.</p>

<p>Now export the token and public URL, like this:</p>

<pre><code class="language-bash">export ID=20f1a9e46ebd42a3bdd03e009722eeb8
export URL=http://localhost:8080/v1/AUTH_8d84a17ac99d49fcb6f35c767dd562db
</code></pre></li>

<li><p>Create a bucket (S3 bucket == OpenStack container)</p>

<pre><code class="language-curl">curl -X PUT \
  -H 'X-Auth-Token: $ID' \
  $URL/bucket1
</code></pre></li>

<li><p>List the buckets</p>

<pre><code class="language-curl">curl -H 'X-Auth-Token: $ID' \
  $URL
</code></pre></li>

<li><p>Put an object into the bucket</p>

<pre><code class="language-curl">curl -X PUT \
  -H 'X-Auth-Token: $ID' \
  --data 'abcdefghi123456789' \
  $URL/bucket1/object1
</code></pre></li>

<li><p>List the objects in the bucket</p>

<pre><code class="language-curl">curl -H 'X-Auth-Token: $ID' \
  $URL/bucket1
</code></pre></li>

<li><p>Fetch the object from the bucket</p>

<pre><code class="language-curl">curl -H 'X-Auth-Token: $ID' \
  $URL/bucket1/object1
</code></pre></li>

<li><p>Delete the object</p>

<pre><code class="language-curl">curl -X DELETE \
  -H 'X-Auth-Token: $ID' \
  $URL/bucket1/object1
</code></pre></li>

<li><p>Delete the bucket</p>

<pre><code class="language-curl">curl -X DELETE \
  -H 'X-Auth-Token: $ID' \
  $URL/bucket1
</code></pre></li>
</ol>

<h3 id="testing-s3-api-and-keystone-authentication">Testing S3 API and Keystone Authentication</h3>

<ol>
<li><p>If Riak and Stanchion are not already running, start them now.</p></li>

<li><p>Edit the Riak CS <code>riak-cs.conf</code>, or the old-style <code>advanced.config</code> or
<code>app.config</code> file and restart Riak CS. The values for <code>rewrite_module</code> and
<code>auth_module</code> should be set as follows:</p>

<pre><code class="language-riakcsconf">rewrite_module = riak_cs_s3_rewrite
auth_module = riak_cs_keystone_auth
</code></pre>

<pre><code class="language-advancedconfig"> {riak_cs, [
            %% Other configs
            {rewrite_module, riak_cs_s3_rewrite},
            {auth_module, riak_cs_keystone_auth},
            %% Other configs
           ]}
</code></pre>

<pre><code class="language-appconfig"> {riak_cs, [
            %% Other configs
            {rewrite_module, riak_cs_s3_rewrite},
            {auth_module, riak_cs_keystone_auth},
            %% Other configs
           ]}
</code></pre></li>

<li><p>Use the values of <code>access</code> and <code>secret</code> from the EC2 credentials
created for the <code>test</code> user as the <code>key_id</code> and <code>key_secret</code> for
signing requests. For example, if you are using <code>s3cmd</code>, use these
credentials for the <code>access_key</code> and <code>secret_key</code> fields of the
<code>.s3cfg</code> file. The subsequent examples are done using <code>s3cmd</code> since
it is a fairly common tool.</p></li>

<li><p>Create a sample file to upload</p>

<pre><code class="language-bash">echo &quot;ilovechickenilovelivermeowmixmeowmixwilldeliver&quot; &gt; upload.txt
</code></pre></li>

<li><p>Create a bucket (i.e. container)</p>

<pre><code class="language-bash">s3cmd mb s3://bucket2
</code></pre></li>

<li><p>List the buckets</p>

<pre><code class="language-bash">s3cmd ls
</code></pre></li>

<li><p>Put an object into the bucket</p>

<pre><code class="language-bash">s3cmd put upload.txt s3://bucket2
</code></pre></li>

<li><p>Fetch the object from the bucket</p>

<pre><code class="language-bash">ss3cmd get s3://bucket2/upload.txt download.txt
</code></pre></li>

<li><p>Delete the object</p>

<pre><code class="language-bash">s3cmd del s3://bucket2/upload.txt
</code></pre></li>

<li><p>Delete the bucket</p>

<pre><code class="language-bash">s3cmd rb s3://bucket2
</code></pre></li>
</ol>

      </main>


    </article>


    <footer class="footer">

  <div class="inline-block   footer__attributions">

    <p>
      This work is licensed under a
      <br class="[bs] hidden-md-up">
      <a href="http://creativecommons.org/licenses/by/4.0/" target="_blank">
        Creative Commons Attribution 4.0 <br class="[bs] hidden-sm-up"> International Public License
      </a>
    </p>

    <p>
      © 2011-2017&nbsp;<a href="http://www.basho.com">Basho Technologies, Inc.</a>
    </p>

  </div>

</footer>



  </div>


  <script src="//evadne.github.io/basho_docs/js/main.js" type="text/javascript"></script>

</body>
</html>
