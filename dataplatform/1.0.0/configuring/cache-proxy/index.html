<!DOCTYPE html>







<html class="no-js" lang="en">




<head>

  <meta charset="utf-8">
  <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
  <meta name="viewport" content="width=device-width">
  <link rel="shortcut icon" href="//evadne.github.io/basho_docs/images/branding/favicon.ico" type="image/x-icon" />

  <title>Getting Started with Cache Proxy</title>

  <link href="//evadne.github.io/basho_docs/css/main.css" media="screen" rel="stylesheet" type="text/css">
  <link rel="canonical" href="//evadne.github.io/basho_docs/dataplatform/latest/configuring/cache-proxy/" />
  <!-- The below meta tags are included to allow JS code to use variables
       defined in Hugo---our static site generator. -->
  <meta name="project" content="dataplatform">
  <meta name="version" content="1.0.0">
  <meta name="project_relative_path" content="configuring/cache-proxy/">

</head>



<body class="dataplatform 1.0.0 latest ">


  <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-T9C8MK" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-T9C8MK');</script>


  
<header class="banner">



  
  <div class="float-right   banner__menu-bars   [bs] hidden-md-up">
    <div class="menu-bars   js_toggle-content-nav"></div>
  </div>



  
  <div class="float-left   banner__docs-logo">
    <a href="//evadne.github.io/basho_docs/index.html" class="block   docs-logo"><img class="docs-logo__image" src="//evadne.github.io/basho_docs/images/branding/basho_docs_logo.png"></a>
  </div>



  
  <div class="overflow-hidden   banner__navigation-pane   [bs] hidden-sm-down">


    
    <div class="float-left    banner__intra-brand__width-wrapper">
    <div class="float-right   banner__intra-brand">
      <div class="float-right">
        
        <a class="inline-block   banner__brand-link" href="http://basho.com/">Basho</a><a class="inline-block   banner__brand-link" href="https://academy.basho.com">Academy</a><a class="inline-block   banner__brand-link" href="//evadne.github.io/basho_docs/community">Community</a><a class="inline-block   banner__brand-link" href="http://basho.com/contact">Contact</a></div>
    </div>
    </div>




    
    <div class="float-left    banner__intra-site__width-wrapper">
    <div class="float-right   banner__intra-site">
      
      <a class="inline-block   banner__brand-link " href="//evadne.github.io/basho_docs/riak/kv/latest/">Riak KV</a><a class="inline-block   banner__brand-link " href="//evadne.github.io/basho_docs/riak/ts/latest/">Riak TS</a><a class="inline-block   banner__brand-link " href="//evadne.github.io/basho_docs/riak/cs/latest/">Riak CS</a></div>
    </div>


  </div>

</header>



  
  



<nav class="content-nav content-nav--top-size-full">




  <div class="content-nav__fixed-top">
    <form id="searchbox_011972015458788978446:zgdcy4fa-o0" class="search" action="">

      <span class="block float-left   search__icon-container   docs-icon--search">|</span>

      <span class="block overflow">
        <input class="search__input" id="main-search" type="search" name="q" placeholder="Search">
      </span>

    </form>


    <div class="clearfix   version-picker">

  

      <div class="inline-block float-right   selector selector--version">
        <header class="selector__title">Versions</header>
        <button class="selector__btn" type="button">1.0.0</button>
        <div    class="selector__arrow"></div>
      </div>

    </div>


  </div>


  
  <div class="overflow-y-hidden   selector-pane__sizing-box selector-pane__sizing-box--hidden">
  <div class="                    selector-pane__shadow-box">

    
    <div class="edge-fader edge-fader--left">
      <span class="inline-block   edge-fader__arrow edge-fader__arrow--invisible"></span>
    </div>
    <div class="edge-fader edge-fader--right">
      <span class="inline-block   edge-fader__arrow edge-fader__arrow--invisible"></span>
    </div>

    <div class="overflow-x        selector-pane__primary selector-pane--versions  js_edge-fader--target">
      
    </div>
  </div>
  </div>




  
  <div class="             content-nav__primary__sizing-box">
  <div class="             content-nav__primary__shadow-box">
  <div class="overflow-y   content-nav__primary">

    <div class="content-nav__menu-container">

      <ul class="content-menu
                 content-menu--depth-0
                 content-menu--open">


        <li >

          <div class="content-menu__item ">

            <span class="block float-left   content-menu__icon-container   docs-icon--riak">|</span>
            <span class="block float-right   content-menu__menu-toggle
                        ">
            </span>

            <a class="block overflow   content-menu__link--depth-0"  href="//evadne.github.io/basho_docs/dataplatform/1.0.0/" >
              <span class="block   content-menu__item__right-border"><strong>Basho Data Platform</strong></span>
            </a>

          </div>
          
          


<ul class="content-menu
           content-menu--depth-1
           "
    style="display: none">



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/dataplatform/1.0.0/downloads/" >
        <span class="block   content-menu__item__right-border">Download Basho Data Platform</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/dataplatform/1.0.0/installing/" >
        <span class="block   content-menu__item__right-border">Installing</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/dataplatform/1.0.0/upgrading/" >
        <span class="block   content-menu__item__right-border">Upgrading from Beta to 1.0.0</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/dataplatform/1.0.0/release-notes/" >
        <span class="block   content-menu__item__right-border">Release Notes</span>
      </a>

    </div>

  </li>



</ul>

        </li>


        <li >

          <div class="content-menu__item ">

            <span class="block float-left   content-menu__icon-container   docs-icon--configure">|</span>
            <span class="block float-right   content-menu__menu-toggle
                         content-menu__menu-toggle--open ">
            </span>

            <a class="block overflow   content-menu__link--depth-0"  href="//evadne.github.io/basho_docs/dataplatform/1.0.0/configuring/" >
              <span class="block   content-menu__item__right-border"><strong>Configuring</strong></span>
            </a>

          </div>
          
          


<ul class="content-menu
           content-menu--depth-1
           content-menu--open"
    style="display: block">



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/dataplatform/1.0.0/configuring/setup-a-cluster/" >
        <span class="block   content-menu__item__right-border">Setup a Data Platform Cluster</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/dataplatform/1.0.0/configuring/replace-spark-cluster-manager/" >
        <span class="block   content-menu__item__right-border">Replacing Spark Cluster Manager</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item  content-menu__item--selected ">

      <a class="block overflow   content-menu__link--depth-1" >
        <span class="block   content-menu__item__right-border">Getting Started with Cache Proxy</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/dataplatform/1.0.0/configuring/default-ports/" >
        <span class="block   content-menu__item__right-border">Default Ports</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/dataplatform/1.0.0/configuring/spark-ip-address/" >
        <span class="block   content-menu__item__right-border">Set Spark IP Address</span>
      </a>

    </div>

  </li>



</ul>

        </li>


        <li >

          <div class="content-menu__item ">

            <span class="block float-left   content-menu__icon-container   docs-icon--database">|</span>
            <span class="block float-right   content-menu__menu-toggle
                        ">
            </span>

            <a class="block overflow   content-menu__link--depth-0"  href="//evadne.github.io/basho_docs/dataplatform/1.0.0/using/" >
              <span class="block   content-menu__item__right-border"><strong>Using</strong></span>
            </a>

          </div>
          
          


<ul class="content-menu
           content-menu--depth-1
           "
    style="display: none">



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/dataplatform/1.0.0/using/start-services/" >
        <span class="block   content-menu__item__right-border">Start Services</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/dataplatform/1.0.0/using/spark-riak-connector/" >
        <span class="block   content-menu__item__right-border">Spark-Riak Connector</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/dataplatform/1.0.0/using/commands/" >
        <span class="block   content-menu__item__right-border">Data Platform Commands</span>
      </a>

    </div>

  </li>



</ul>

        </li>


        <li >

          <div class="content-menu__item ">

            <span class="block float-left   content-menu__icon-container   docs-icon--beaker">|</span>
            <span class="block float-right   content-menu__menu-toggle
                        ">
            </span>

            <a class="block overflow   content-menu__link--depth-0"  href="//evadne.github.io/basho_docs/dataplatform/1.0.0/learn/" >
              <span class="block   content-menu__item__right-border"><strong>Learn</strong></span>
            </a>

          </div>
          
          


<ul class="content-menu
           content-menu--depth-1
           "
    style="display: none">



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/dataplatform/1.0.0/learn/service-manager/" >
        <span class="block   content-menu__item__right-border">Service Manager</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/dataplatform/1.0.0/learn/cache-proxy/" >
        <span class="block   content-menu__item__right-border">Cache Proxy</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/dataplatform/1.0.0/learn/leader-election-service/" >
        <span class="block   content-menu__item__right-border">Leader Election Service</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/dataplatform/1.0.0/learn/spark-cluster-manager/" >
        <span class="block   content-menu__item__right-border">Spark Cluster Manager</span>
      </a>

    </div>

  </li>



</ul>

        </li>

        <li class="content-menu__blank-entry"></li>

      </ul>

    </div>



    <div class="content-nav__fixed-bottom">

      <ul class="content-menu">

        <li>
          <div class="content-menu__item">

            <span class="block float-left   content-menu__icon-container   docs-icon--comments">|</span>

            <a class="block overflow" href="//evadne.github.io/basho_docs/community">
              <span class="block   content-menu__item__right-border">
                <sub>Want some extra help?</sub><br>
                <strong>Ask our Community</strong>
              </span>
            </a>

          </div>
        </li>

        <li>
          <div class="content-menu__item">

            <span class="block float-left   content-menu__icon-container   docs-icon--question-sign">|</span>

            <a class="block overflow" href="http://basho.com/contact">
              <span class="block   content-menu__item__right-border">
                <sub>Need to chat?</sub><br>
                <strong>Contact us directly</strong>
              </span>
            </a>

          </div>
        </li>

        <li>
          <div class="content-menu__item">

            <span class="block float-left   content-menu__icon-container   docs-icon--github-alt">|</span>

            <a class="block overflow" href="https://github.com/basho/basho_docs/edit/master/content/dataplatform/1.0.0/configuring/cache-proxy.md">
              <span class="block   content-menu__item__right-border">
                <sub>Noticed a typo?</sub><br>
                <strong>Correct it in GitHub</strong>
              </span>
            </a>

          </div>
        </li>

      </ul>

    </div>

  </div>
  </div>
  </div>



</nav>

<script>
  (function() {
    var cx = '011972015458788978446:zgdcy4fa-o0';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<div style="width:0px;overflow:hidden;height:0px;">
  <gcse:search></gcse:search>
</div>






  <div class="content-well">


    <article class="main-article">


      

<header class="front-matter">


  <h1 class="front-matter__title">

    
    <br>
    Getting Started with Cache Proxy

  </h1>
  <nav class="table-of-contents"></nav>


</header>


      <main>
        

<blockquote>
<p>Cache proxy is available to <a href="http://info.basho.com/Wiki_Riak_Enterprise_Request.html">Enterprise users only</a>.</p>
</blockquote>

<p>Now that you’ve <a href="//evadne.github.io/basho_docs/dataplatform/1.0.0/configuring/setup-a-cluster/">set up a Basho Data Platform cluster</a>, which included <a href="//evadne.github.io/basho_docs/dataplatform/1.0.0/configuring/setup-a-cluster/#add-services">adding a service configuration for Redis and cache proxy</a>, you’re ready to use cache proxy with any Redis client that supports the <code>GET</code> command.</p>

<p>This page will walk you through configuring and using BDP cache proxy.</p>

<h2 id="prerequisites">Prerequisites</h2>

<h3 id="setting-your-environment">Setting Your Environment</h3>

<p>Before you begin using cache proxy, you may want to set your environment variables. You will be using these paths frequently, and you may find it easier to use their logical names rather than typing the paths out each time.</p>

<p>We suggest the following environment settings (and the remainder of this page assumes you are using these settings).</p>

<p>If you are running Ubuntu, set this environment variable at the command line:</p>

<pre><code class="language-bash">BDP_PRIV=&quot;/usr/lib/riak/lib/data_platfor-1/priv&quot;
</code></pre>

<p>If you are running CentOS, set this environment variable at the command line:</p>

<pre><code class="language-bash">BDP_PRIV=&quot;/usr/lib64/riak/lib/data_platform-1/priv&quot;
</code></pre>

<h2 id="configure-cache-proxy">Configure Cache Proxy</h2>

<p>Cache proxy was configured for you during the general BDP install and configuration process. BDP Service Manager provides everything you need to configure, start, and stop the cache proxy.</p>

<p>If you skipped the configuration instructions or would otherwise like to set up a different cache proxy configuration, this section will show you how.</p>

<h3 id="configuration-file">Configuration File</h3>

<p>If you are curious about cache proxy&rsquo;s internal configuration or just want to look at your configuration to make sure it is correct or to see what hostname and port is being used, you can find it in <code>$BDP_PRIV/cache_proxy/config/cache_proxy_$CACHE_PROXY_PORT.yml</code>.</p>

<div class="blocknote">
  
  <p>This level of knowledge is not necessary for normal operation, but may come in
handy when diagnosing and resolving issues, such as a firewall rule not
allowing ingress to the cache proxy host on the configured port.</p>

</div>


<p>Once you&rsquo;ve opened the file, you might find the following settings helpful:</p>

<ul>
<li><code>CACHE_PROXY_PORT</code> - Specifies the cache proxy client port which uses a reduced set of the Redis protocol, default: 22122.</li>
<li><code>CACHE_PROXY_STATS_PORT</code> - Sets the cache proxy statistics port which is useful for monitoring, default: 22123.</li>
<li><code>CACHE_TTL</code> - Specifies the cache time-to-live (TTL) expiry, which is used when cache proxy sets a value to Redis, default: &ldquo;15s&rdquo; (15 seconds).</li>
<li><code>RIAK_KV_SERVERS</code> - A comma-separated list of IP:PORT where the PORT is the protocol buffer (pb) port of the Riak KV servers.</li>
<li><code>REDIS_SERVERS</code> - A comma-separated list of IP:PORT where the PORT is the Redis client port.</li>
</ul>

<h3 id="redis-service-configuration">Redis Service Configuration</h3>

<p>To add a Redis service configuration:</p>

<pre><code class="language-bash">sudo data-platform-admin add-service-config my-redis redis HOST=&quot;0.0.0.0&quot; REDIS_PORT=&quot;»REDIS_PORT«&quot;
</code></pre>

<h3 id="cache-proxy-service-configuration">Cache Proxy Service Configuration</h3>

<p>To add a Cache Proxy service configuration:</p>

<pre><code class="language-bash">sudo data-platform-admin add-service-config my-cache-proxy cache-proxy HOST=&quot;0.0.0.0&quot; CACHE_PROXY_PORT=&quot;»CACHE_PROXY_PORT«&quot; CACHE_PROXY_STATS_PORT=&quot;»CACHE_PROXY_STATS_PORT«&quot; CACHE_TTL=&quot;15s&quot; RIAK_KV_SERVERS=&quot;»RIAK_IP_1«:»RIAK_PB_PORT«,»RIAK_IP_2«:»RIAK_PB_PORT«&quot; REDIS_SERVERS=&quot;»REDIS_IP_1«:»REDIS_PORT«,»REDIS_IP_2«:»REDIS_PORT«&quot;
</code></pre>

<h3 id="start-redis-service">Start Redis Service</h3>

<p>To start the Redis service on a BDP node, run:</p>

<pre><code class="language-bash">sudo data-platform-admin start-service »RIAK_NODENAME«@»RIAK_IP« my-group my-redis
</code></pre>

<h3 id="start-cache-proxy-service">Start Cache Proxy Service</h3>

<p>To start the cache proxy service on a BDP node, run:</p>

<pre><code class="language-shell">sudo data-platform-admin start-service »RIAK_NODENAME«@»RIAK_IP« my-group my-cache-proxy
</code></pre>

<p>Here&rsquo;s a simple way to test your cache proxy configuration:</p>

<pre><code class="language-bash"># NOTE: BDP_PRIV set above
RIAK_IP=»RIAK_IP«
RIAK_HTTP_PORT=»RIAK_HTTP_PORT«
CACHE_PROXY_IP=»CACHE_PROXY_IP«
CACHE_PROXY_PORT=»CACHE_PROXY_PORT«
REDIS_IP=»REDIS_IP«
REDIS_PORT=»REDIS_PORT«
BUCKET=&quot;my-bucket&quot;
KEY=&quot;my-key&quot;
curl -s -X PUT -d &quot;my-value&quot; &quot;http://$RIAK_IP:$RIAK_HTTP_PORT/buckets/$BUCKET/keys/$KEY&quot;
$BDP_PRIV/redis/bin/redis-cli -h $CACHE_PROXY_IP -p $CACHE_PROXY_PORT get $BUCKET:$KEY
$BDP_PRIV/redis/bin/redis-cli -h $REDIS_IP -p $REDIS_PORT get $BUCKET:$KEY
</code></pre>

<h3 id="run-the-read-through-test">Run the Read-Through Test</h3>

<p>You can test your cache proxy setup with a specific script if you installed the Basho Data Platform Extras package (Enterprise only).</p>

<p>The test ensures that your configuration correctly tracks values obtained from Riak KV and cache proxy. The main actions of the read-through test are:</p>

<ul>
<li>Delete the Riak object at the <code>test</code> bucket with the key <code>foo</code>, which checks that there are no siblings.</li>
<li>PUT a Riak object with the value &lsquo;bar&rsquo; at the <code>test</code> bucket with the key <code>foo</code>.</li>
<li>GET the Riak object at the <code>test</code> bucket with the key <code>foo</code>.</li>
<li>GET the string-representation of the object from cache proxy using the key <code>test:foo</code>. (Cache proxy should parse out the first portion of the Redis colon-separated key (namespace) to identify which Riak bucket to perform the backend read from.)</li>
<li>Assert that the value obtained from the previous cache proxy GET is &lsquo;bar&rsquo;.</li>
</ul>

<p>The testing script is located in <code>$BDP_PRIV/cache-proxy/test/read_through_test.sh</code>, and takes the following command-line arguments:</p>

<ul>
<li>$1 - Riak KV HTTP port</li>
<li>$2 - Riak KV HTTP host</li>
<li>$3 - Riak KV test bucket name</li>
</ul>

<p>Before we get to the command to run the test script, let&rsquo;s look at the general bash commands the read-through test is running:</p>

<pre><code class="language-bash"># set test environment
RIAK_HTTP_IP=&quot;127.0.0.1&quot;
RIAK_HTTP_PORT=&quot;8098&quot;
CACHE_PROXY_IP=&quot;127.0.0.1&quot;
CACHE_PROXY_PORT=&quot;22122&quot;
CACHE_PROXY_STATISTICS_PORT=&quot;22123&quot;
RIAK_TEST_BUCKET=&quot;test&quot;
KEY=&quot;foo&quot;
VALUE=&quot;bar&quot;

# DELETE Riak object, ensure no siblings
curl -s -X DELETE &quot;http://$RIAK_HTTP_IP:$RIAK_HTTP_PORT/buckets/$RIAK_TEST_BUCKET/keys/$KEY&quot;

# PUT Riak object
curl -s -X PUT -d &quot;$VALUE&quot; &quot;http://$RIAK_HTTP_IP:$RIAK_HTTP_PORT/buckets/$RIAK_TEST_BUCKET/keys/$KEY&quot;

# GET Riak object
RIAK_VALUE=$(curl -s -X GET &quot;http://$RIAK_HTTP_IP:$RIAK_HTTP_PORT/buckets/$RIAK_TEST_BUCKET/keys/$KEY&quot;)

# GET Cache Proxy value
CACHE_VALUE=$(redis-cli -h &quot;$CACHE_PROXY_IP&quot; -p &quot;$CACHE_PROXY_PORT&quot; &quot;$RIAK_TEST_BUCKET:$KEY&quot;

# DELETE Riak object, cleanup
curl -s -X DELETE &quot;http://$RIAK_HTTP_IP:$RIAK_HTTP_PORT/buckets/$RIAK_TEST_BUCKET/keys/$KEY&quot;

# Assert
if [[ &quot;RIAK_VALUE&quot; == &quot;$CACHE_VALUE&quot; ]]; then
    RESULT=&quot;Success&quot;
else
    RESULT=&quot;FAIL&quot;
fi
echo &quot;$RESULT - read $RIAK_VALUE from Riak and $CACHE_VALUE from Cache Proxy.&quot;
</code></pre>

<p>Are you ready to run the read-through test? You can run it as follows:</p>

<pre><code class="language-bash">./read_through_test.sh 22122 8098 test
</code></pre>

<h4 id="exceptions">Exceptions</h4>

<p>If the test does not pass, verify that both Redis and cache proxy are running. You can do this by running:</p>

<pre><code class="language-bash">sudo data-platform-admin services
</code></pre>

<p>The result should list <code>my-redis</code> and <code>my-cache-proxy</code> with the Running Services table.</p>

<p>Also, verify that Riak KV is started and listening on the protocol buffer port specified:</p>

<pre><code class="language-bash">sudo riak config effective |grep proto
</code></pre>

<p>If cache proxy is misconfigured, reconfigure it by updating the service config with the <code>--force</code> option.</p>

<p>If cache proxy is configured correctly and all required services are running, you may want to restart each service from front to back as follows:</p>

<ol>
<li>Stop cache proxy</li>
<li>Stop Redis.</li>
<li>[Optional] Restart Riak KV (This should only be necessary if Riak KV is not responding to protocol buffer requests.)</li>
<li>Start Redis.</li>
<li>Start cache proxy.</li>
</ol>

<pre><code class="language-bash">sudo data-platform-admin stop-service 'my-cache-group' 'my-cache-proxy'
sudo data-platform-admin stop-service 'my-cache-group' 'my-cache-proxy'

# optional
sudo riak restart

sudo data-platform-admin start-service 'my-cache-group' 'my-cache-proxy'
sudo data-platform-admin start-service 'my-cache-group' 'my-cache-proxy'
</code></pre>

<h2 id="using-cache-proxy">Using Cache Proxy</h2>

<p>Once you&rsquo;ve successfully configured cache proxy and established a Riak KV and Redis client in the language of your choosing, you&rsquo;re ready to start using cache proxy.</p>

<p>For objects that should not be cached, interact with Riak KV as usual issuing GET, PUT, and DELETE commands through the Riak client.</p>

<p>For objects that should be cached, read from cache proxy issuing GET commands through the Redis client, and write to Riak KV issuing PUT and DELETE commands through the Riak client.</p>

<h3 id="monitoring">Monitoring</h3>

<h4 id="cache-proxy">Cache Proxy</h4>

<p>Internally, the BDP service manager monitors processes, so will automatically restart a service with the correct configuration in the event that the service’s process was killed or terminated by other means.</p>

<p>For additional monitoring, cache proxy provides statistics on service availability.  The statistics provided are generally useful in monitoring the health of the cache proxy service.</p>

<p>For example, running the following:</p>

<pre><code class="language-bash">telnet $CACHE_PROXY_IP $CACHE_PROXY_STATISTICS_PORT
</code></pre>

<p>Returns statistic results:</p>

<pre><code class="language-json">{
    &quot;bdp_cache_proxy&quot;: {
        &quot;192.168.50.2:6379&quot;: {
            &quot;in_queue&quot;: 0,
            &quot;in_queue_bytes&quot;: 0,
            &quot;out_queue&quot;: 0,
            &quot;out_queue_bytes&quot;: 0,
            &quot;request_bytes&quot;: 216,
            &quot;requests&quot;: 9,
            &quot;response_bytes&quot;: 39,
            &quot;responses&quot;: 4,
            &quot;server_connections&quot;: 1,
            &quot;server_ejected_at&quot;: 0,
            &quot;server_eof&quot;: 0,
            &quot;server_err&quot;: 0,
            &quot;server_timedout&quot;: 0
        },
        &quot;192.168.50.3:6379&quot;: {
            &quot;in_queue&quot;: 0,
            &quot;in_queue_bytes&quot;: 0,
            &quot;out_queue&quot;: 0,
            &quot;out_queue_bytes&quot;: 0,
            &quot;request_bytes&quot;: 0,
            &quot;requests&quot;: 0,
            &quot;response_bytes&quot;: 0,
            &quot;responses&quot;: 0,
            &quot;server_connections&quot;: 0,
            &quot;server_ejected_at&quot;: 0,
            &quot;server_eof&quot;: 0,
            &quot;server_err&quot;: 0,
            &quot;server_timedout&quot;: 0
        },
        &quot;192.168.50.4:6379&quot;: {
            &quot;in_queue&quot;: 0,
            &quot;in_queue_bytes&quot;: 0,
            &quot;out_queue&quot;: 0,
            &quot;out_queue_bytes&quot;: 0,
            &quot;request_bytes&quot;: 90,
            &quot;requests&quot;: 5,
            &quot;response_bytes&quot;: 258,
            &quot;responses&quot;: 2,
            &quot;server_connections&quot;: 0,
            &quot;server_ejected_at&quot;: 0,
            &quot;server_eof&quot;: 0,
            &quot;server_err&quot;: 0,
            &quot;server_timedout&quot;: 0
        },
        &quot;client_connections&quot;: 0,
        &quot;client_eof&quot;: 6,
        &quot;client_err&quot;: 0,
        &quot;forward_error&quot;: 0,
        &quot;fragments&quot;: 0,
        &quot;server_ejects&quot;: 0
    },
    &quot;curr_connections&quot;: 4,
    &quot;service&quot;: &quot;nutcracker&quot;,
    &quot;source&quot;: &quot;vagrant&quot;,
    &quot;timestamp&quot;: 1438301846,
    &quot;total_connections&quot;: 10,
    &quot;uptime&quot;: 7227,
    &quot;version&quot;: &quot;0.4.0&quot;
}
</code></pre>

<p>Using the above, you should be able to determine metrics changes that would flag a change in service health.  With this information you can implement monitoring to help guarantee the overall health of cache proxy, other BDP services, and the custom software within your overall solution.  While we do not specifically endorse a specific monitoring solution, the open interface to statistics allows for several monitoring solutions, the following is a brief listing:</p>

<ul>
<li>Custom - <a href="https://github.com/gfranxman/NutcrackerMonitor">https://github.com/gfranxman/NutcrackerMonitor</a></li>
<li>NewRelic - <a href="http://newrelic.com/plugins/schoology/245">http://newrelic.com/plugins/schoology/245</a></li>
<li>Nagios - <a href="https://github.com/schoology/twemproxy_nagios">https://github.com/schoology/twemproxy_nagios</a></li>
</ul>

<h4 id="redis">Redis</h4>

<p>Various Redis monitoring solutions exist in the market and like monitoring the cache proxy, these monitoring solutions make underlying calls to obtain Redis statistics, typically via the <code>info</code> command alone.</p>

<p>As with cache proxy, Redis statistics available on the Redis client port allow for monitoring via solutions such as the following:</p>

<ul>
<li>Custom - <a href="http://volumelabs.net/redis_monitoring/">http://volumelabs.net/redis_monitoring/</a></li>
<li>NewRelic - <a href="http://newrelic.com/plugins/poison-pen-llc/28">http://newrelic.com/plugins/poison-pen-llc/28</a></li>
<li>Nagios - <a href="https://exchange.nagios.org/directory/Plugins/Databases/check_redis-2Epl/details">https://exchange.nagios.org/directory/Plugins/Databases/check_redis-2Epl/details</a></li>
</ul>

      </main>


    </article>


    <footer class="footer">

  <div class="inline-block   footer__attributions">

    <p>
      This work is licensed under a
      <br class="[bs] hidden-md-up">
      <a href="http://creativecommons.org/licenses/by/4.0/" target="_blank">
        Creative Commons Attribution 4.0 <br class="[bs] hidden-sm-up"> International Public License
      </a>
    </p>

    <p>
      © 2011-2017&nbsp;<a href="http://www.basho.com">Basho Technologies, Inc.</a>
    </p>

  </div>

</footer>



  </div>


  <script src="//evadne.github.io/basho_docs/js/main.js" type="text/javascript"></script>

</body>
</html>
