<!DOCTYPE html>







<html class="no-js" lang="en">




<head>

  <meta charset="utf-8">
  <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
  <meta name="viewport" content="width=device-width">
  <link rel="shortcut icon" href="//evadne.github.io/basho_docs/images/branding/favicon.ico" type="image/x-icon" />

  <title>Leader Election Service</title>

  <link href="//evadne.github.io/basho_docs/css/main.css" media="screen" rel="stylesheet" type="text/css">
  <link rel="canonical" href="//evadne.github.io/basho_docs/dataplatform/latest/learn/leader-election-service/" />
  <!-- The below meta tags are included to allow JS code to use variables
       defined in Hugo---our static site generator. -->
  <meta name="project" content="dataplatform">
  <meta name="version" content="1.0.0">
  <meta name="project_relative_path" content="learn/leader-election-service/">

</head>



<body class="dataplatform 1.0.0 latest ">


  <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-T9C8MK" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-T9C8MK');</script>


  
<header class="banner">



  
  <div class="float-right   banner__menu-bars   [bs] hidden-md-up">
    <div class="menu-bars   js_toggle-content-nav"></div>
  </div>



  
  <div class="float-left   banner__docs-logo">
    <a href="//evadne.github.io/basho_docs/index.html" class="block   docs-logo"><img class="docs-logo__image" src="//evadne.github.io/basho_docs/images/branding/basho_docs_logo.png"></a>
  </div>



  
  <div class="overflow-hidden   banner__navigation-pane   [bs] hidden-sm-down">


    
    <div class="float-left    banner__intra-brand__width-wrapper">
    <div class="float-right   banner__intra-brand">
      <div class="float-right">
        
        <a class="inline-block   banner__brand-link" href="http://basho.com/">Basho</a><a class="inline-block   banner__brand-link" href="https://academy.basho.com">Academy</a><a class="inline-block   banner__brand-link" href="//evadne.github.io/basho_docs/community">Community</a><a class="inline-block   banner__brand-link" href="http://basho.com/contact">Contact</a></div>
    </div>
    </div>




    
    <div class="float-left    banner__intra-site__width-wrapper">
    <div class="float-right   banner__intra-site">
      
      <a class="inline-block   banner__brand-link " href="//evadne.github.io/basho_docs/riak/kv/latest/">Riak KV</a><a class="inline-block   banner__brand-link " href="//evadne.github.io/basho_docs/riak/ts/latest/">Riak TS</a><a class="inline-block   banner__brand-link " href="//evadne.github.io/basho_docs/riak/cs/latest/">Riak CS</a></div>
    </div>


  </div>

</header>



  
  



<nav class="content-nav content-nav--top-size-full">




  <div class="content-nav__fixed-top">
    <form id="searchbox_011972015458788978446:zgdcy4fa-o0" class="search" action="">

      <span class="block float-left   search__icon-container   docs-icon--search">|</span>

      <span class="block overflow">
        <input class="search__input" id="main-search" type="search" name="q" placeholder="Search">
      </span>

    </form>


    <div class="clearfix   version-picker">

  

      <div class="inline-block float-right   selector selector--version">
        <header class="selector__title">Versions</header>
        <button class="selector__btn" type="button">1.0.0</button>
        <div    class="selector__arrow"></div>
      </div>

    </div>


  </div>


  
  <div class="overflow-y-hidden   selector-pane__sizing-box selector-pane__sizing-box--hidden">
  <div class="                    selector-pane__shadow-box">

    
    <div class="edge-fader edge-fader--left">
      <span class="inline-block   edge-fader__arrow edge-fader__arrow--invisible"></span>
    </div>
    <div class="edge-fader edge-fader--right">
      <span class="inline-block   edge-fader__arrow edge-fader__arrow--invisible"></span>
    </div>

    <div class="overflow-x        selector-pane__primary selector-pane--versions  js_edge-fader--target">
      
    </div>
  </div>
  </div>




  
  <div class="             content-nav__primary__sizing-box">
  <div class="             content-nav__primary__shadow-box">
  <div class="overflow-y   content-nav__primary">

    <div class="content-nav__menu-container">

      <ul class="content-menu
                 content-menu--depth-0
                 content-menu--open">


        <li >

          <div class="content-menu__item ">

            <span class="block float-left   content-menu__icon-container   docs-icon--riak">|</span>
            <span class="block float-right   content-menu__menu-toggle
                        ">
            </span>

            <a class="block overflow   content-menu__link--depth-0"  href="//evadne.github.io/basho_docs/dataplatform/1.0.0/" >
              <span class="block   content-menu__item__right-border"><strong>Basho Data Platform</strong></span>
            </a>

          </div>
          
          


<ul class="content-menu
           content-menu--depth-1
           "
    style="display: none">



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/dataplatform/1.0.0/downloads/" >
        <span class="block   content-menu__item__right-border">Download Basho Data Platform</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/dataplatform/1.0.0/installing/" >
        <span class="block   content-menu__item__right-border">Installing</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/dataplatform/1.0.0/upgrading/" >
        <span class="block   content-menu__item__right-border">Upgrading from Beta to 1.0.0</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/dataplatform/1.0.0/release-notes/" >
        <span class="block   content-menu__item__right-border">Release Notes</span>
      </a>

    </div>

  </li>



</ul>

        </li>


        <li >

          <div class="content-menu__item ">

            <span class="block float-left   content-menu__icon-container   docs-icon--configure">|</span>
            <span class="block float-right   content-menu__menu-toggle
                        ">
            </span>

            <a class="block overflow   content-menu__link--depth-0"  href="//evadne.github.io/basho_docs/dataplatform/1.0.0/configuring/" >
              <span class="block   content-menu__item__right-border"><strong>Configuring</strong></span>
            </a>

          </div>
          
          


<ul class="content-menu
           content-menu--depth-1
           "
    style="display: none">



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/dataplatform/1.0.0/configuring/setup-a-cluster/" >
        <span class="block   content-menu__item__right-border">Setup a Data Platform Cluster</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/dataplatform/1.0.0/configuring/replace-spark-cluster-manager/" >
        <span class="block   content-menu__item__right-border">Replacing Spark Cluster Manager</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/dataplatform/1.0.0/configuring/cache-proxy/" >
        <span class="block   content-menu__item__right-border">Getting Started with Cache Proxy</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/dataplatform/1.0.0/configuring/default-ports/" >
        <span class="block   content-menu__item__right-border">Default Ports</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/dataplatform/1.0.0/configuring/spark-ip-address/" >
        <span class="block   content-menu__item__right-border">Set Spark IP Address</span>
      </a>

    </div>

  </li>



</ul>

        </li>


        <li >

          <div class="content-menu__item ">

            <span class="block float-left   content-menu__icon-container   docs-icon--database">|</span>
            <span class="block float-right   content-menu__menu-toggle
                        ">
            </span>

            <a class="block overflow   content-menu__link--depth-0"  href="//evadne.github.io/basho_docs/dataplatform/1.0.0/using/" >
              <span class="block   content-menu__item__right-border"><strong>Using</strong></span>
            </a>

          </div>
          
          


<ul class="content-menu
           content-menu--depth-1
           "
    style="display: none">



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/dataplatform/1.0.0/using/start-services/" >
        <span class="block   content-menu__item__right-border">Start Services</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/dataplatform/1.0.0/using/spark-riak-connector/" >
        <span class="block   content-menu__item__right-border">Spark-Riak Connector</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/dataplatform/1.0.0/using/commands/" >
        <span class="block   content-menu__item__right-border">Data Platform Commands</span>
      </a>

    </div>

  </li>



</ul>

        </li>


        <li >

          <div class="content-menu__item ">

            <span class="block float-left   content-menu__icon-container   docs-icon--beaker">|</span>
            <span class="block float-right   content-menu__menu-toggle
                         content-menu__menu-toggle--open ">
            </span>

            <a class="block overflow   content-menu__link--depth-0"  href="//evadne.github.io/basho_docs/dataplatform/1.0.0/learn/" >
              <span class="block   content-menu__item__right-border"><strong>Learn</strong></span>
            </a>

          </div>
          
          


<ul class="content-menu
           content-menu--depth-1
           content-menu--open"
    style="display: block">



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/dataplatform/1.0.0/learn/service-manager/" >
        <span class="block   content-menu__item__right-border">Service Manager</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/dataplatform/1.0.0/learn/cache-proxy/" >
        <span class="block   content-menu__item__right-border">Cache Proxy</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item  content-menu__item--selected ">

      <a class="block overflow   content-menu__link--depth-1" >
        <span class="block   content-menu__item__right-border">Leader Election Service</span>
      </a>

    </div>

  </li>



  <li>

    <div class="content-menu__item ">

      <a class="block overflow   content-menu__link--depth-1"  href="//evadne.github.io/basho_docs/dataplatform/1.0.0/learn/spark-cluster-manager/" >
        <span class="block   content-menu__item__right-border">Spark Cluster Manager</span>
      </a>

    </div>

  </li>



</ul>

        </li>

        <li class="content-menu__blank-entry"></li>

      </ul>

    </div>



    <div class="content-nav__fixed-bottom">

      <ul class="content-menu">

        <li>
          <div class="content-menu__item">

            <span class="block float-left   content-menu__icon-container   docs-icon--comments">|</span>

            <a class="block overflow" href="//evadne.github.io/basho_docs/community">
              <span class="block   content-menu__item__right-border">
                <sub>Want some extra help?</sub><br>
                <strong>Ask our Community</strong>
              </span>
            </a>

          </div>
        </li>

        <li>
          <div class="content-menu__item">

            <span class="block float-left   content-menu__icon-container   docs-icon--question-sign">|</span>

            <a class="block overflow" href="http://basho.com/contact">
              <span class="block   content-menu__item__right-border">
                <sub>Need to chat?</sub><br>
                <strong>Contact us directly</strong>
              </span>
            </a>

          </div>
        </li>

        <li>
          <div class="content-menu__item">

            <span class="block float-left   content-menu__icon-container   docs-icon--github-alt">|</span>

            <a class="block overflow" href="https://github.com/basho/basho_docs/edit/master/content/dataplatform/1.0.0/learn/leader-election-service.md">
              <span class="block   content-menu__item__right-border">
                <sub>Noticed a typo?</sub><br>
                <strong>Correct it in GitHub</strong>
              </span>
            </a>

          </div>
        </li>

      </ul>

    </div>

  </div>
  </div>
  </div>



</nav>

<script>
  (function() {
    var cx = '011972015458788978446:zgdcy4fa-o0';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<div style="width:0px;overflow:hidden;height:0px;">
  <gcse:search></gcse:search>
</div>






  <div class="content-well">


    <article class="main-article">


      

<header class="front-matter">


  <h1 class="front-matter__title">

    
    <br>
    Leader Election Service

  </h1>
  <nav class="table-of-contents"></nav>


</header>


      <main>
        

<blockquote>
<p>Leader Election Service is available to <a href="http://info.basho.com/Wiki_Riak_Enterprise_Request.html">Enterprise users only</a>.</p>
</blockquote>

<h2 id="overview">Overview</h2>

<p>The Basho Data Platform (BDP) Leader Election Service enables Spark clusters to run without a ZooKeeper instance.</p>

<p>The Leader Election Service uses a simple, line-based, ascii protocol to interact with Spark. This protocol is incompatible with the ZooKeeper protocol, and requires a BDP-specific patch to Spark for compatibility purposes. The Protocol Details section of this page further details the Leader Election Service protocol.</p>

<p>The service can be run on any or all nodes in a Riak cluster, so long as those nodes have <a href="https://github.com/basho/riak_ensemble"><code>riak_ensemble</code></a>. Because it uses a strongly consistent backing store that is spread across the entire cluster, it does not normally matter which nodes are running the service. As long as there are no network partitions or outages interfering with normal operation, you should be able to point Spark to any Riak node that is running the election service, and everything will work the same way regardless.</p>

<p>Many groups of clients can use the election service at the same time by defining different election group names when they connect. If a client connects to a group that does not currently exist, it will be automatically created. That client is then elected leader. Leaders remain elected indefinitely until they disconnect from the service. A new leader is chosen from the remaining clients.</p>

<h2 id="setup-and-configuration">Setup and Configuration</h2>

<p>Before enabling the leader election service, strong consistency must be enabled on your Riak cluster, as described in the Managing Strong Consistency documentation. You can verify that strong consistency has been successfully enabled by using the ‘riak-admin ensemble-status’ command.</p>

<p>By default, any new data platform installation will include a commented template configuration for the leader election service in <code>riak.conf</code>. This should look something like this:</p>

<pre><code class="language-riakconf">## listener.leader_latch.internal = 127.0.0.1:5323
</code></pre>

<p>If you uncomment this line on a given node and restart Riak, that node will start listening for leader election clients over the loopback interface on TCP port 5323. Changing the IP address here changes which network interface the service listens on. This be necessary if Spark is running on a different host from Riak.</p>

<blockquote>
<p><strong>Warning</strong></p>

<p>Please note that this service provides no authentication mechanism. Whatever network interface you use must be shielded from external connection attempts. Otherwise an outside attacker could potentially perform a denial of service attack against your cluster.</p>
</blockquote>

<p>The example configuration above specifies a single interface/port pair to listen on. The “internal” part of this configuration line is a name given to this instance of the service.</p>

<p>You can replace “internal” with whatever name you like. You can also specify as many listener interfaces as you choose, as long as multiple listeners on the same node have different names.</p>

<p>For example:</p>

<pre><code class="language-riakconf">listener.leader_latch.internal = 127.0.0.1:5323
listener.leader_latch.external = 10.10.1.2:5323
listener.leader_latch.testing = 192.168.0.42:12345
</code></pre>

<p>Note that changes to these settings will not have an impact on a live running node. You must restart the given Riak node for changes to take effect.</p>

<h2 id="operational-concerns">Operational Concerns</h2>

<p>The leader service relies on a strongly consistent backing store, shared by all the nodes in the Riak cluster. To guarantee liveness of this backing store, a majority of nodes in the cluster must be available and able to communicate with one another. If a node running the election service loses contact with a majority of other nodes (due to downed nodes, network outages, performance problems, etc.), then the service will become unavailable until the situation is resolved.</p>

<p>As mentioned before, this service provides no security guarantees or authentication mechanisms of any kind. It is your responsibility to prevent outside access to the leader election service.</p>

<h2 id="protocol-details">Protocol Details</h2>

<p>The following section details the implementation of the election service. This may be helpful for debugging and testing the election service, or creating a new client beyond the existing Spark connector.</p>

<h3 id="implementation">Implementation</h3>

<p>The protocol used for this service is a simple, line-based, ascii protocol. You can test and interact with the service using telnet (or an equivalent utility).</p>

<p>There is currently only one command a client can send to the service:</p>

<pre><code class="language-telnet">JOIN »group_name« »client_name«
</code></pre>

<p>This command tells the election service to add a client named <code>»client_name«</code> to an election group named »group_name«`.</p>

<p>Both the client name and the group name must be ascii strings with no spaces in them. Under normal circumstances, the service should respond with:</p>

<pre><code>LEADER »current_leader«
</code></pre>

<p>The connection must remain open as long as the client wishes to remain a part of the election group. Any subsequent leader changes will be asynchronously pushed to the client across this same connection.</p>

<p>If the service becomes unavailable (for example, an outage involving a majority of Riak nodes) and a client attempts to join an election group, the server may respond with an error message reading:</p>

<pre><code>JOIN_FAILED SERVICE_UNAVAILABLE
</code></pre>

<p>If a client attempts to execute any additional joins (to the same or other group names) on the same connection after the initial join is performed, the server will respond with:</p>

<pre><code>ALREADY_JOINED »group_name« »client_name«
</code></pre>

<p>And the additional join attempt(s) will fail.</p>

<p>If a client attempts to send an invalid command the server will respond with <code>ERROR</code>.</p>

<h3 id="example-session">Example Session</h3>

<p>Following is an example interaction with the election service:</p>

<pre><code class="language-bash">telnet 127.0.0.1 5323
</code></pre>

<pre><code class="language-telnet">Trying 127.0.0.1...

Connected to localhost.

Escape character is '^]'.

JOIN test_group 1

JOIN_FAILED SERVICE_UNAVAILABLE

Connection closed by foreign host.
</code></pre>

<p>In this case the cluster only had one out of three members online, because we forgot to start the other two nodes. Because a majority of members were offline, we were unable to join the election group. If we start up the other two nodes and try again::</p>

<pre><code class="language-bash">telnet 127.0.0.1 5323
</code></pre>

<pre><code class="language-telnet">Trying 127.0.0.1...

Connected to localhost.

Escape character is '^]'.

JOIN test_group 1

LEADER 1
</code></pre>

<p>Great. We have one member named &ldquo;1&rdquo; in test_group, so as we expect, they are elected leader. Now let&rsquo;s leave that session running, then open another terminal and join another member to the group:</p>

<pre><code class="language-bash">telnet 127.0.0.1 5323
</code></pre>

<pre><code class="language-telnet">Trying 127.0.0.1...

Connected to localhost.

Escape character is '^]'.

JOIN test_group 2

LEADER 1
</code></pre>

<p>Since 1 is still up and running, they&rsquo;re still the leader. When we join 2 to the group, it tells us that 1 is the current leader. If we close our first terminal window, then this new session should be elected leader after a short timeout. Let&rsquo;s try it out:</p>

<pre><code class="language-telnet">LEADER 2
</code></pre>

<p>Our new connection is notified that client 2 is the new leader.</p>

      </main>


    </article>


    <footer class="footer">

  <div class="inline-block   footer__attributions">

    <p>
      This work is licensed under a
      <br class="[bs] hidden-md-up">
      <a href="http://creativecommons.org/licenses/by/4.0/" target="_blank">
        Creative Commons Attribution 4.0 <br class="[bs] hidden-sm-up"> International Public License
      </a>
    </p>

    <p>
      © 2011-2017&nbsp;<a href="http://www.basho.com">Basho Technologies, Inc.</a>
    </p>

  </div>

</footer>



  </div>


  <script src="//evadne.github.io/basho_docs/js/main.js" type="text/javascript"></script>

</body>
</html>
